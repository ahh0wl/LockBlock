<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.js"></script>
    <script src="https://tg.dev/js/telegram-web-app.js?7"></script>
    <script src="game.js"></script>
    <title>LockBlock</title>
    <style>
        body {
            background: url(./sprites/wall.png) center center;
            background-size: cover;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }
        .tot {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;

        }
        .game-container {
            width: 100%;
            max-width: 512px;
            aspect-ratio: 1;
            display: flex;
            background-color: transparent; 
            border: 1px solid black;
        }
        .touch-controls {
            display: flex;
            justify-content: center;
            width: 100%;
            align-items: center;
            margin-top: 10px;
        }
        .control-button {
            width: 80px;
            height: 80px;
            margin: 0 10px;
            font-size: 16px;
            background-color: #343A40;
            color: white;
            border-color: white;
            border-radius: 10px;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        .control-button:active, .control-button:focus {
            border-color: white;
        }
        .control-button:active {
            background-color: #555;
        }
        .options {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            position: relative;
        }
        svg {
            margin: 0 auto; /* Center the SVG within its button */
        }
        .option-button {
            width: 40px;
            height: 40px;
            margin: 0 5px;
            font-size: 16px;
            background-color: #343A40;
            color: white;
            border-color: white;
            border-radius: 10px;
            user-select: none;
            z-index: 999;
        }
        .option-button:active {
            background-color: #555;
        }
        .collapse-right {
            display: flex;
            overflow: hidden;
            transition: width 0.3s ease-in-out;
            width: 0;
        }
        .collapse-right.show {
            width: auto;
        }
        .edit-message {
            position:absolute;
            padding: 10px;
            display: flex;        
            text-align: center; 
            width: 60%;
            font-size: 3wp;
            font-family: 'Press Start 2P';
            color: #fd0b0b;
            display: none;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            top: 7%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .edit-message.show {
            display: block; /* Show when the "show" class is added */
        }
		.grid-overlay {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0, 0, 0, 0.5); /* Adjust the opacity as needed */
			pointer-events: none; /* Allows clicking through the overlay */
			display: none; /* Initially hide the overlay */
		}
		.overlay.show {
			display: block; /* Show the overlay when it's active */
		}
		
		.grid-image {
            width: 100%;
            height: auto;
            max-width: 512px;
            position: absolute;
            pointer-events: none;
            display: none; /* Initially hidden */
        }
        .start-message {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 80%; /* Adjust to control width relative to .game-container */
            height: 10%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 4vw;
            font-family: 'Press Start 2P';
            font-weight: bold;
            text-align: center;
            background: rgba(0, 0, 0, 0); /* Optional: adds a semi-transparent dark background */
            padding: 10px 20px;
            border-radius: 8px;
            z-index: 10;
            animation: pulsate 1.5s ease-in-out infinite; 
        }
        @media (min-width: 768px) { /* Adjust based on when you want the font to cap */
            .start-message {
                font-size: 18px; /* Set a maximum font size for larger screens */
            }
        }
        @keyframes pulsate {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1); /* Normal scale */
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2); /* Scale up to 110% */
            }
        }
    </style>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>
<body>
    <div class="tot">
        <div class="options">
			<!--toggleoptions-->
            <button class="option-button" id="options-button">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#e8eaed">
                    <path d="M0 0h24v24H0z" fill="none"/>
                    <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
                </svg>
            </button>
			<!--editmode-->
            <div class="collapse-right" id="content">
                <button class="option-button" id="edit-mode-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-square" viewBox="0 0 16 16">
						<path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
						<path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
					  </svg>
                </button>
            </div>
        </div>
		<div class="edit-message" id="edit-message" style="white-space: pre-line">Edit mode
            in the works!</div>
        <div class="game-container" id="game-container">
            <div class="start-message" id="start-message">Press anything to Play!</div>
			<img class="grid-image" src="./sprites/grid.png">
		</div>
        <div class="touch-controls" id="touch-controls">
			<!--leftbutton-->
            <button class="control-button" id="left-button">
				<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-caret-left-fill" viewBox="0 0 16 16">
					<path d="m3.86 8.753 5.482 4.796c.646.566 1.658.106 1.658-.753V3.204a1 1 0 0 0-1.659-.753l-5.48 4.796a1 1 0 0 0 0 1.506z"/>
				</svg>
			</button>
			<!--upbutton-->
            <button class="control-button" id="up-button">
				<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-caret-up-fill" viewBox="0 0 16 16">
					<path d="m7.247 4.86-4.796 5.481c-.566.647-.106 1.659.753 1.659h9.592a1 1 0 0 0 .753-1.659l-4.796-5.48a1 1 0 0 0-1.506 0z"/>
				  </svg>
			</button>
			<!--rightbutton-->
            <button class="control-button" id="right-button">
				<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-right-fill" viewBox="0 0 16 16">
					<path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/>
				  </svg>
			</button>
        </div>
    </div>
    <script>
        // Handle touch controls

        document.addEventListener('DOMContentLoaded', () => {
            const startMessage = document.getElementById('start-message');
            const gameContainer = document.getElementById('game-container');
            const optionsButton = document.getElementById('options-button');
            const movementButtons = document.querySelectorAll('.control-button');

            function startGame() {
                startMessage.style.display = 'none';

                // Remove event listeners to prevent multiple triggers
                gameContainer.removeEventListener('pointerdown', startGame);
                optionsButton.removeEventListener('pointerdown', startGame);
                movementButtons.forEach(button => {
                    button.removeEventListener('pointerdown', startGame);
                });
                document.removeEventListener('keydown', startGame);
            }

            // Listen for pointerdown on game container and options button
            gameContainer.addEventListener('pointerdown', startGame);
            optionsButton.addEventListener('pointerdown', startGame);
            movementButtons.forEach(button => {
                button.addEventListener('pointerdown', startGame); // Add event listeners to movement buttons
            });
            document.addEventListener('keydown', startGame);
        });


        document.getElementById('options-button').addEventListener('click', function () {
            var content = document.getElementById('content');
            content.classList.toggle('show');
        });
        document.getElementById('edit-mode-button').addEventListener('click', function () {
            const overlay = document.getElementById('grid-overlay');
            document.getElementById('edit-message').classList.toggle('show');
            overlay.style.display = overlay.style.display === 'none' ? 'block' : 'none';
        });
        document.addEventListener('touchstart', function (event) {
        if (event.touches.length > 1) {
                event.preventDefault(); // Prevents multi-touch actions
            }
        }, { passive: false });

        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault(); // Prevents double-tap zoom
            }
            lastTouchEnd = now;
        }, { passive: false });
    </script>
</body>
</html>
